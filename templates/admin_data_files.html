<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆ.txt / data ãƒ•ã‚©ãƒ«ãƒ€ï¼‰</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;background:#f6faf9;margin:0}
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  h1{font-size:20px;margin:0 0 12px}
  .topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{padding:8px 14px;border:0;border-radius:8px;background:#2a8ed8;color:#fff;cursor:pointer}
  .btn.secondary{background:#6b7280}
  .btn.ghost{background:#fff;border:1px solid #cbd5e1;color:#2a8ed8}
  .btn.danger{background:#e11d48}
  .btn.warn{background:#f59e0b;color:#111}
  .panel{background:#fff;border-radius:12px;box-shadow:0 4px 16px #c6d4e71a;padding:14px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:16px}
  .list table{width:100%;border-collapse:collapse}
  .list th,.list td{border-bottom:1px solid #e5e7eb;padding:6px 8px;font-size:13px}
  .list th{background:#f1f5f9;text-align:left}
  .note{font-size:12px;color:#64748b}
  .flash{background:#ecfeff;border:1px solid #bae6fd;color:#075985;padding:8px 10px;border-radius:8px;margin:8px 0}
  .editor textarea{
    width:100%; height:62vh; box-sizing:border-box; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:13px; border:1px solid #cbd5e1; border-radius:8px; padding:10px; background:#fff;
    white-space:pre; overflow:auto; resize:vertical; /* æŠ˜è¿”ã—OFFï¼†æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
  }
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap; margin:6px 0}
  input[type=text], input[type=file], select{
    padding:6px 8px; border:1px solid #cbd5e1; border-radius:8px; background:#fff; font-size:13px;
  }
  .right{display:flex;gap:8px;align-items:center;justify-content:flex-end}
</style>
</head>
<body>
{% include '_back_to_data.html' %}
<div class="wrap">
  <div class="topbar">
    <h1>ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆ/data ãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ï¼‰</h1>
    <a class="btn secondary" href="{{ url_for('admin_entry') }}">â† è¦³å…‰ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¸</a>
    <span class="note">â€» .txt/.md ã‚’å¯¾è±¡ã«ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ç·¨é›†ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»å‰Šé™¤ãƒ»ãƒªãƒãƒ¼ãƒ ãŒã§ãã¾ã™</span>
  </div>

  <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="flash">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="grid">

    <!-- å·¦ï¼šãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ / æ“ä½œ -->
    <div class="panel list">
      <form class="row" method="post" action="{{ url_for('admin_data_files_new') }}">
        <input type="text" name="new_name" placeholder="æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆä¾‹ï¼šæ¡ˆå†…ãƒ†ãƒ³ãƒ—ãƒ¬.txtï¼‰" style="flex:1;min-width:220px">
        <button class="btn" type="submit">ï¼‹ æ–°è¦ä½œæˆ</button>
      </form>

      <form class="row" method="post" action="{{ url_for('admin_data_files_upload') }}" enctype="multipart/form-data">
        <input type="file" name="txt_files" accept=".txt,.md" multiple>
        <button class="btn" type="submit">â†‘ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
      </form>

      <table>
        <thead><tr><th>åå‰</th><th style="width:90px;">ã‚µã‚¤ã‚º</th><th style="width:140px;">æ›´æ–°æ—¥æ™‚</th><th style="width:210px;">æ“ä½œ</th></tr></thead>
        <tbody>
        {% for f in files %}
          <tr>
            <td>{{ f.name }}</td>
            <td>{{ "{:,}".format(f.size) }} B</td>
            <td>{{ f.mtime }}</td>
            <td>
              <a class="btn ghost" href="{{ url_for('admin_data_files', edit=f.name) }}">ç·¨é›†</a>
              <a class="btn ghost" href="{{ url_for('admin_data_files_download', name=f.name) }}">DL</a>
              <form style="display:inline" method="post" action="{{ url_for('admin_data_files_delete') }}" onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                <input type="hidden" name="del_name" value="{{ f.name }}">
                <button class="btn danger" type="submit">å‰Šé™¤</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="4" class="note">ã¾ã ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- å³ï¼šã‚¨ãƒ‡ã‚£ã‚¿ -->
    <div class="panel editor">
      {% if edit %}
        <form method="post" action="{{ url_for('admin_data_files_save') }}">
          <div class="row">
            <input type="text" name="edit_name" value="{{ edit }}" style="flex:1;min-width:260px">
            <select name="save_encoding" title="ä¿å­˜æ™‚ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰">
              <option value="utf-8" selected>UTF-8ï¼ˆæ¨å¥¨ï¼‰</option>
              <option value="cp932">CP932ï¼ˆExcel/Windowså‘ã‘ï¼‰</option>
            </select>
            <button class="btn warn" type="submit">ğŸ’¾ ä¸Šæ›¸ãä¿å­˜</button>
            <a class="btn ghost" href="{{ url_for('admin_data_files') }}">Ã— é–‰ã˜ã‚‹</a>
          </div>
          <div class="note">èª­ã¿è¾¼ã¿æ™‚ã®æ¨å®š: {{ used_enc or 'ä¸æ˜' }} ï¼ ã‚¨ãƒ‡ã‚£ã‚¿ã¯æŠ˜è¿”ã—ç„¡åŠ¹ãƒ»æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯</div>
          <textarea name="content" spellcheck="false" wrap="off">{{ content }}</textarea>
        </form>

        <form class="row" method="post" action="{{ url_for('admin_data_files_rename') }}" onsubmit="return confirm('åå‰ã‚’å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ')">
          <input type="hidden" name="old_name" value="{{ edit }}">
          <input type="text" name="new_name" placeholder="æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆ.txt æ¨å¥¨ï¼‰" style="flex:1;min-width:260px">
          <button class="btn" type="submit">â†”ï¸ åå‰å¤‰æ›´</button>
        </form>
      {% else %}
        <div class="note">å·¦ã®ä¸€è¦§ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶ã‹ã€æ–°è¦ä½œæˆ/ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</div>
      {% endif %}
    </div>

  </div>
</div>
</body>
</html>
