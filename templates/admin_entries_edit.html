<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>è¦³å…‰ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç·¨é›†ï¼ˆUIï¼‰</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;background:#f6faf9;margin:0}
  .wrap{max-width:1200px;margin:28px auto;padding:0 16px}
  .top{display:flex;gap:10px;align-items:center;margin-bottom:14px}
  .btn{padding:8px 14px;border:0;border-radius:8px;background:#2a8ed8;color:#fff;cursor:pointer}
  .btn.secondary{background:#6b7280}
  .btn.danger{background:#e11d48}
  .btn.ghost{background:#fff;border:1px solid #cbd5e1;color:#2a8ed8}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #c6d4e71a}
  th,td{border-bottom:1px solid #e5e7eb;padding:8px;vertical-align:top;font-size:13px}
  th{background:#f1f5f9;text-align:left;white-space:nowrap}
  input[type=text], textarea, select{width:100%;box-sizing:border-box;font-size:13px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:8px;background:#fff}
  textarea{min-height:42px;resize:vertical}
  .muted{opacity:.45}
  .row-actions{display:flex;gap:6px}
  .note{font-size:12px;color:#64748b;margin-left:8px}
  .savebar{position:sticky;bottom:0;background:#f6faf9;padding:10px 0;margin-top:10px}
  .csvbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 16px}
  .flash{background:#ecfeff;border:1px solid #bae6fd;color:#075985;padding:8px 10px;border-radius:8px;margin:8px 0}
</style>
<script>
function addRow(){
  const tpl = document.getElementById('row-template');
  const tbody = document.getElementById('tbody');
  const clone = tpl.content.cloneNode(true);
  tbody.appendChild(clone);
}
function removeRow(btn){
  const tr = btn.closest('tr');
  tr.parentNode.removeChild(tr);
}
function onCategoryChange(sel){
  const tr = sel.closest('tr');
  const isTourism = (sel.value === 'è¦³å…‰');
  tr.querySelectorAll('[data-shop]').forEach(el=>{
    el.disabled = isTourism;
    el.classList.toggle('muted', isTourism);
  });
}
window.addEventListener('DOMContentLoaded', ()=>{
  document.querySelectorAll('select[name="category[]"]').forEach(onCategoryChange);
});
</script>
</head>
<body>
<div class="wrap">
  <div class="top">
    <h1 style="margin:0;font-size:20px;">è¦³å…‰ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç·¨é›†ï¼ˆUIï¼‰</h1>
    <span class="note">â€»ã‚¿ã‚°/ã‚¨ãƒªã‚¢/æ”¯æ‰•æ–¹æ³•ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›</span>
    <a class="btn secondary" href="{{ url_for('admin_entry') }}">â† ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
  </div>

  <!-- â–¼ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥è¡¨ç¤ºï¼ˆæˆåŠŸ/ã‚¨ãƒ©ãƒ¼ï¼‰ -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="flash">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- â–¼ CSV å–ã‚Šè¾¼ã¿ï¼ˆæ—¢å­˜ã«è¿½åŠ ï¼‰ -->
  <form class="csvbar" method="post" action="{{ url_for('admin_entries_import_csv') }}" enctype="multipart/form-data">
    <input type="file" name="csv_file" accept=".csv">
    <button class="btn" type="submit">CSVã‚’å–ã‚Šè¾¼ã‚€ï¼ˆæ—¢å­˜ã«è¿½åŠ ï¼‰</button>
    <span class="note">åˆ—ï¼šcategory,title,desc,address,map,tags,areas,links,extras,extra_â—‹â—‹â€¦ï¼ˆtitle/descå¿…é ˆï¼‰</span>
    <a class="btn ghost" href="{{ url_for('admin_entries_edit') }}">æœ€æ–°ã®å†…å®¹ã‚’å†èª­è¾¼</a>
  </form>

  <!-- â–¼ æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®ã€Œä¿å­˜ã€ã¯å¾“æ¥ã©ãŠã‚Š /admin/entries_edit ã«POSTã•ã‚Œã‚‹æƒ³å®šï¼‰ -->
  <form method="post">
    <table>
      <thead>
        <tr>
          <th style="width:110px;">ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
          <th style="width:180px;">ã‚¿ã‚¤ãƒˆãƒ«</th>
          <th>èª¬æ˜</th>
          <th style="width:180px;">ä½æ‰€</th>
          <th style="width:180px;">åœ°å›³URL</th>
          <th style="width:160px;">ã‚¿ã‚°</th>
          <th style="width:160px;">ã‚¨ãƒªã‚¢</th>
          <th style="width:110px;">é›»è©±</th>
          <th style="width:120px;">ä¼‘ã¿</th>
          <th style="width:140px;">å–¶æ¥­æ™‚é–“</th>
          <th style="width:90px;">é§è»Š</th>
          <th style="width:70px;">å°æ•°</th>
          <th style="width:150px;">æ”¯æ‰•æ–¹æ³•</th>
          <th style="width:160px;">å‚™è€ƒ</th>
          <th style="width:80px;">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="tbody">
        {% for e in entries %}
        <tr>
          <td>
            <select name="category[]" onchange="onCategoryChange(this)">
              {% set cats = ["è¦³å…‰","é£²é£Ÿ","å®¿æ³Š","è¨ºç™‚æ‰€","å½¹æ‰€","äº¤é€š","ãƒã‚¹","ã‚¤ãƒ™ãƒ³ãƒˆ","ç‰¹å£²"] %}
              {% for c in cats %}
                <option value="{{ c }}" {% if e.category==c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
          </td>
          <td><input type="text" name="title[]" value="{{ e.title or '' }}"></td>
          <td><textarea name="desc[]">{{ e.desc or '' }}</textarea></td>
          <td><input type="text" name="address[]" value="{{ e.address or '' }}"></td>
          <td><input type="text" name="map[]" value="{{ e.map or '' }}"></td>
          <td><input type="text" name="tags[]" value="{% if e.tags %}{{ ','.join(e.tags) }}{% endif %}"></td>
          <td><input type="text" name="areas[]" value="{% if e.areas %}{{ ','.join(e.areas) }}{% endif %}"></td>

          <td><input data-shop type="text" name="tel[]" value="{{ e.tel or '' }}"></td>
          <td><input data-shop type="text" name="holiday[]" value="{{ e.holiday or '' }}"></td>
          <td><input data-shop type="text" name="open_hours[]" value="{{ e.open_hours or '' }}"></td>
          <td>
            <select data-shop name="parking[]">
              <option value="" {% if not e.parking %}selected{% endif %}>-</option>
              <option value="ã‚ã‚Š" {% if e.parking=='ã‚ã‚Š' %}selected{% endif %}>ã‚ã‚Š</option>
              <option value="ãªã—" {% if e.parking=='ãªã—' %}selected{% endif %}>ãªã—</option>
            </select>
          </td>
          <td><input data-shop type="text" name="parking_num[]" value="{{ e.parking_num or '' }}"></td>
          <td><input data-shop type="text" name="payment[]" value="{% if e.payment %}{{ ','.join(e.payment) }}{% endif %}"></td>
          <td><input data-shop type="text" name="remark[]" value="{{ e.remark or '' }}"></td>

          <td class="row-actions">
            <button class="btn danger" type="button" onclick="removeRow(this)">å‰Šé™¤</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="savebar">
      <button class="btn" type="button" onclick="addRow()">ï¼‹ è¡Œã‚’è¿½åŠ </button>
      <button class="btn" type="submit">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </div>

    <!-- è¿½åŠ ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
    <template id="row-template">
      <tr>
        <td>
          <select name="category[]" onchange="onCategoryChange(this)">
            <option value="è¦³å…‰" selected>è¦³å…‰</option>
            <option value="é£²é£Ÿ">é£²é£Ÿ</option>
            <option value="å®¿æ³Š">å®¿æ³Š</option>
            <option value="è¨ºç™‚æ‰€">è¨ºç™‚æ‰€</option>
            <option value="å½¹æ‰€">å½¹æ‰€</option>
            <option value="äº¤é€š">äº¤é€š</option>
            <option value="ãƒã‚¹">ãƒã‚¹</option>
            <option value="ã‚¤ãƒ™ãƒ³ãƒˆ">ã‚¤ãƒ™ãƒ³ãƒˆ</option>
            <option value="ç‰¹å£²">ç‰¹å£²</option>
          </select>
        </td>
        <td><input type="text" name="title[]" value=""></td>
        <td><textarea name="desc[]"></textarea></td>
        <td><input type="text" name="address[]" value=""></td>
        <td><input type="text" name="map[]" value=""></td>
        <td><input type="text" name="tags[]" value=""></td>
        <td><input type="text" name="areas[]" value=""></td>

        <td><input data-shop type="text" name="tel[]" value=""></td>
        <td><input data-shop type="text" name="holiday[]" value=""></td>
        <td><input data-shop type="text" name="open_hours[]" value=""></td>
        <td>
          <select data-shop name="parking[]">
            <option value="" selected>-</option>
            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
            <option value="ãªã—">ãªã—</option>
          </select>
        </td>
        <td><input data-shop type="text" name="parking_num[]" value=""></td>
        <td><input data-shop type="text" name="payment[]" value=""></td>
        <td><input data-shop type="text" name="remark[]" value=""></td>

        <td class="row-actions">
          <button class="btn danger" type="button" onclick="removeRow(this)">å‰Šé™¤</button>
        </td>
      </tr>
    </template>
  </form>
</div>
</body>
</html>
