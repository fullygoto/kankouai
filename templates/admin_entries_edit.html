<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>è¦³å…‰ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç·¨é›†ï¼ˆUIï¼‰</title>
<style>
  :root{
    --bg:#f6faf9; --panel:#fff; --muted:#64748b; --line:#e5e7eb; --brand:#2a8ed8;
  }
  *{box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif;background:var(--bg);margin:0}
  .wrap{max-width:1200px;margin:28px auto;padding:0 16px}
  .top{display:flex;gap:10px;align-items:center;margin-bottom:14px;flex-wrap:wrap}
  .btn{padding:8px 14px;border:0;border-radius:8px;background:var(--brand);color:#fff;cursor:pointer}
  .btn.secondary{background:#6b7280}
  .btn.danger{background:#e11d48}
  .btn.ghost{background:#fff;border:1px solid #cbd5e1;color:var(--brand)}
  .note{font-size:12px;color:var(--muted);margin-left:8px}
  .flash{background:#ecfeff;border:1px solid #bae6fd;color:#075985;padding:8px 10px;border-radius:8px;margin:8px 0}

  /* simple card */
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0;box-shadow:0 4px 16px #c6d4e71a}
  .card h2{margin:0 0 8px;font-size:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

  /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ overflow-x */
  .table-wrap{overflow-x:auto;background:var(--panel);border-radius:12px;box-shadow:0 4px 16px #c6d4e71a}
  table{border-collapse:collapse;min-width:1960px;width:100%}
  th,td{border-bottom:1px solid var(--line);padding:8px;vertical-align:top;font-size:13px;background:#fff}
  thead th{position:sticky;top:0;background:#f1f5f9;text-align:left;white-space:nowrap;z-index:1}
  input[type=text], textarea, select{
    width:100%;font-size:13px;padding:6px 8px;border:1px solid #cbd5e1;border-radius:8px;background:#fff
  }
  textarea{min-height:72px;resize:vertical;line-height:1.5}
  textarea[name="desc[]"]{font-size:14px}
  .row-actions{display:flex;gap:6px}
  .savebar{position:sticky;bottom:0;background:var(--bg);padding:10px 0;margin-top:10px;display:flex;gap:10px}

  /* CSVãƒãƒ¼ */
  .csvbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 16px}
  .csvbar input[type=file]{background:#fff;border:1px solid #cbd5e1;border-radius:8px;padding:6px}

  /* JSONå…¨æ–‡ä¸Šæ›¸ãï¼ˆä¸Šç´šè€…ï¼‰ */
  details.jsonbox{margin:16px 0}
  details.jsonbox .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px}
  .jsonbox textarea{width:100%;min-height:220px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  summary{cursor:pointer}
  .muted{opacity:.45}

  /* preview list */
  .preview{max-height:240px;overflow:auto;border:1px dashed #cbd5e1;border-radius:8px;padding:8px;background:#fafcff}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef6ff;color:#2563eb;font-size:12px;margin-left:6px}
</style>
<script>
function addRow(){
  const tpl = document.getElementById('row-template');
  const tbody = document.getElementById('tbody');
  const clone = tpl.content.cloneNode(true);
  tbody.appendChild(clone);
}
function removeRow(btn){
  const tr = btn.closest('tr');
  tr.parentNode.removeChild(tr);
}
function onCategoryChange(sel){
  const tr = sel.closest('tr');
  const isTourism = (sel.value === 'è¦³å…‰');
  tr.querySelectorAll('[data-shop]').forEach(el=>{
    el.disabled = isTourism;
    el.classList.toggle('muted', isTourism);
  });
}
window.addEventListener('DOMContentLoaded', ()=>{
  document.querySelectorAll('select[name="category[]"]').forEach(onCategoryChange);
  const uiForm = document.getElementById('entries-ui-form');
  if(uiForm){
    uiForm.addEventListener('submit', ev=>{
      if(!guardUiSubmit(uiForm)){
        ev.preventDefault();
        ev.stopPropagation();
      }
    });
  }
  const rawForm = document.getElementById('entries-raw-form');
  if(rawForm){
    rawForm.addEventListener('submit', ev=>{
      if(!guardRawSubmit(rawForm)){
        ev.preventDefault();
        ev.stopPropagation();
      }
    });
  }
});

/* ===== é‡è¤‡çµ±åˆï¼ˆAIæœ€é©åŒ–ï¼‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ===== */
async function previewDedupe(){
  const box = document.getElementById('dedupe_preview');
  const meta = document.getElementById('dedupe_meta');
  box.innerHTML = 'èª­ã¿è¾¼ã¿ä¸­â€¦';
  meta.textContent = '';
  try{
    const r = await fetch('{{ url_for("admin_entries_dedupe") }}', {credentials:'same-origin'});
    const j = await r.json();
    if(!j || !j.ok){
      box.innerHTML = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
      return;
    }
    const stats = j.stats || {};
    meta.innerHTML =
      'é‡è¤‡ã‚°ãƒ«ãƒ¼ãƒ—: <b>'+ (stats.merged_groups||0) +'</b> / çµ±åˆå¾Œä»¶æ•°: <b>'+ (stats.total_after||'-') +'</b>'
      + ' <span class="pill">å‰Šé™¤äºˆå®š: '+ (stats.removed||0) +'</span>';

    const list = (j.preview||[]).map((p,i)=>(
      (i+1)+'. '+ escapeHtml(p.title||'(ç„¡é¡Œ)') +'  <span class="muted">ï¼ˆ'+ (p.merged_from||1) +' ä»¶ã‚’çµ±åˆï¼‰</span>'
    ));
    box.innerHTML = list.length ? '<ul><li>'+ list.join('</li><li>') +'</li></ul>' : 'é‡è¤‡ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚';
  }catch(e){
    box.innerHTML = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šä¿¡ã‚¨ãƒ©ãƒ¼: '+ e;
  }
}
function runDedupe(){
  if(confirm('ã‚¿ã‚¤ãƒˆãƒ«é‡è¤‡ã‚’AIæœ€é©åŒ–ã§çµ±åˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨ï¼‰')){
    document.getElementById('dedupe_form').submit();
  }
}
function escapeHtml(s){
  return (s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

function markAllowEmpty(form, allow){
  const hidden = form.querySelector('input[name="allow_empty"]');
  if(hidden){ hidden.value = allow ? '1' : ''; }
}

function guardUiSubmit(form){
  const rows = form.querySelectorAll('#tbody tr');
  for(const tr of rows){
    const title = tr.querySelector('input[name="title[]"]');
    const areas = tr.querySelector('input[name="areas[]"]');
    if(title && areas){
      if(title.value.trim() && areas.value.trim()){
        markAllowEmpty(form, false);
        return true;
      }
    }
  }
  if(confirm('å…¨ä»¶ã‚’ç©ºã®çŠ¶æ…‹ã§ä¿å­˜ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã® entries.json ã¯ç©ºé…åˆ—ã§ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚æœ¬å½“ã«å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ')){
    markAllowEmpty(form, true);
    return true;
  }
  markAllowEmpty(form, false);
  return false;
}

function guardRawSubmit(form){
  const textarea = form.querySelector('textarea[name="entries_raw"]');
  const raw = textarea ? textarea.value.trim() : '';
  let needsConfirm = false;
  if(!raw){
    needsConfirm = true;
  }else{
    try{
      const parsed = JSON.parse(raw);
      if(Array.isArray(parsed) && parsed.length === 0){
        needsConfirm = true;
      }
    }catch(e){
      markAllowEmpty(form, false);
      return true;
    }
  }
  if(needsConfirm){
    if(confirm('0ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã§ entries.json ã‚’ç½®æ›ã—ã¾ã™ã€‚ç¾åœ¨ã®å†…å®¹ã¯ã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ')){
      markAllowEmpty(form, true);
      return true;
    }
    markAllowEmpty(form, false);
    return false;
  }
  markAllowEmpty(form, false);
  return true;
}
</script>
</head>
<body>
{% include '_back_to_data.html' %}
<div class="wrap">
  {% set _base_cats = ["è¦³å…‰","é£²é£Ÿ","å®¿æ³Š","è¨ºç™‚æ‰€","å½¹æ‰€","äº¤é€š","ãƒã‚¹","ã‚¤ãƒ™ãƒ³ãƒˆ","ç‰¹å£²"] %}
  {% set _fg_cats = ["æ±‚äºº","äº”å³¶ã‚’è´ˆã‚ã†","è¦³å…‰","æ³Šã¾ã‚‹","é£Ÿã¹ã‚‹ãƒ»å‘‘ã‚€","ãã‚Œã„","ç™’ã—","ã‚·ãƒ§ãƒƒãƒ—","ç”Ÿæ´»","è¶£å‘³ãƒ»ç¿’ã„äº‹"] %}
  {% set _ns = namespace(cats=_base_cats[:]) %}
  {% for c in _fg_cats %}
    {% if c not in _ns.cats %}{% set _ = _ns.cats.append(c) %}{% endif %}
  {% endfor %}
  {% set cat_list = _ns.cats %}
  <div class="top">
    <h1 style="margin:0;font-size:20px;">è¦³å…‰ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç·¨é›†ï¼ˆUIï¼‰</h1>
    <span class="note">â€»ã‚¿ã‚°/ã‚¨ãƒªã‚¢/æ”¯æ‰•æ–¹æ³•ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›</span>
    <a class="btn secondary" href="{{ url_for('admin_entry') }}">â† ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>
  </div>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="flash">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- ã‚µãƒ¼ãƒå†…ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆZIPï¼‰: app.py ã§ snapshots ã‚’æ¸¡ã—ã¦ã„ãªã„å ´åˆã§ã‚‚è¡¨ç¤ºã¯å®‰å…¨ã§ã™ -->
  <div class="card">
    <h2>ã‚µãƒ¼ãƒå†…ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆZIPï¼‰</h2>
    <div class="row" style="margin-bottom:8px">
      <form method="post" action="{{ url_for('admin_snapshot_create') }}">
        <button class="btn" type="submit">ğŸ“¦ ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆ</button>
      </form>
      <span class="note">ãƒ‡ãƒ¼ã‚¿ï¼ˆdata/ï¼‰ã€ç”»åƒï¼ˆstatic/uploads/ãƒ»images/ï¼‰ã€entries.json ã‚’ZIPã§ä¿å­˜ã—ã¾ã™ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸è¦ï¼‰ã€‚</span>
    </div>
    {% if snapshots and snapshots|length %}
      <div class="row" style="gap:8px;align-items:center;margin-bottom:8px">
        <form method="post" action="{{ url_for('admin_snapshot_restore') }}"
              onsubmit="return confirm('é¸æŠã—ãŸã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§å¾©å…ƒã—ã¾ã™ã€‚ç¾åœ¨ã®å†…å®¹ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');">
          <select name="fname">
            {% for s in snapshots %}
              <option value="{{ s.name }}">
                {{ s.name }}ï¼ˆ{{ (s.size/1048576)|round(1) }} MB / {{ s.mtime.strftime('%Y-%m-%d %H:%M') }}ï¼‰
              </option>
            {% endfor %}
          </select>
          <button class="btn danger" type="submit">âª ã“ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§å¾©å…ƒ</button>
        </form>
      </div>
      <ul style="margin:0;padding-left:18px">
        {% for s in snapshots %}
        <li>
          <code>{{ s.name }}</code>
          <span class="note"> â€” {{ (s.size/1048576)|round(1) }} MB / {{ s.mtime.strftime('%Y-%m-%d %H:%M') }}</span>
          <a class="btn ghost" style="margin-left:8px" href="{{ url_for('admin_snapshot_download', fname=s.name) }}">â¬‡ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="note">ã¾ã ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€ŒğŸ“¦ ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã€ã‚’æŠ¼ã™ã¨ä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
    {% endif %}
  </div>

  <div class="card">
    <h2>ã‚¿ã‚¤ãƒˆãƒ«é‡è¤‡ã®çµ±åˆï¼ˆAIæœ€é©åŒ–ï¼‰</h2>
    <div class="row" style="margin-bottom:8px">
      <button class="btn ghost" type="button" onclick="previewDedupe()">ğŸ‘€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—</button>
      <form id="dedupe_form" method="post" action="{{ url_for('admin_entries_dedupe') }}">
        <button class="btn" type="button" onclick="runDedupe()">âœ¨ çµ±åˆã‚’å®Ÿè¡Œ</button>
      </form>
      <span class="note">â€» èª¬æ˜æ–‡ã¯AIã§æœ€é©åŒ–ï¼ˆç’°å¢ƒå¤‰æ•° <code>DEDUPE_USE_AI=1</code> æ™‚ï¼‰ã€‚å®Ÿè¡Œå‰ã« <a class="btn ghost" href="{{ url_for('admin_backup') }}">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</a> ã‚’æ¨å¥¨ã€‚</span>
    </div>
    <div id="dedupe_meta" class="note" style="margin-bottom:6px"></div>
    <div id="dedupe_preview" class="preview">ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æœªå–å¾—ï¼‰</div>
  </div>

  <form class="csvbar" method="post" action="{{ url_for('admin_entries_import_csv') }}" enctype="multipart/form-data">
    <input type="file" name="csv_file" accept=".csv">
    <button class="btn" type="submit">CSVã‚’å–ã‚Šè¾¼ã‚€ï¼ˆæ—¢å­˜ã«è¿½åŠ ï¼‰</button>
    <span class="note">åˆ—ï¼šcategory,title,desc,address,map,tags,areas,links,extras,extra_â—‹â—‹â€¦ï¼ˆtitle/desc/areaså¿…é ˆï¼‰</span>
    <a class="btn ghost" href="{{ url_for('admin_entries_edit') }}">æœ€æ–°ã®å†…å®¹ã‚’å†èª­è¾¼</a>
  </form>

  <details class="jsonbox">
    <summary>JSONå…¨æ–‡ä¸Šæ›¸ãï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰ã‚’é–‹ã</summary>
    <div class="panel">
      <form id="entries-raw-form" method="post" action="{{ url_for('admin_entries_edit') }}">
        <p class="note">ã“ã®ã‚¨ãƒªã‚¢ã« <code>[{{'{'}} ... {{'}'}}]</code> å½¢å¼ã§ <b>entries.json</b> ã®é…åˆ—ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Œä¸Šæ›¸ãä¿å­˜ã€ã‚’æŠ¼ã™ã¨ã€DBã‚’ä¸¸ã”ã¨ç½®ãæ›ãˆã¾ã™ã€‚</p>
        <input type="hidden" name="allow_empty" value="">
        <textarea name="entries_raw" placeholder='[
  {"category":"è¦³å…‰","title":"ä¾‹","desc":"èª¬æ˜","areas":["äº”å³¶å¸‚"],"tags":["æ•™ä¼š"],"address":"","map":"","links":[]}
]'></textarea>
        <div style="margin-top:8px;display:flex;gap:8px;">
          <button class="btn danger" type="submit">âš  JSONã§ä¸Šæ›¸ãä¿å­˜</button>
          <a class="btn ghost" href="{{ url_for('admin_entries_edit') }}">ã‚„ã‚ã‚‹ï¼ˆå†èª­è¾¼ï¼‰</a>
        </div>
      </form>
    </div>
  </details>

  <form id="entries-ui-form" method="post" action="{{ url_for('admin_entries_edit') }}">
    <input type="hidden" name="allow_empty" value="">
    <div class="table-wrap">
      <table>
        <colgroup>
          <!-- åˆ—é †ã‚’ã€Œæ“ä½œ â†’ ã‚«ãƒ†ã‚´ãƒªãƒ¼ â†’ ã‚¿ã‚¤ãƒˆãƒ« â€¦ã€ã«å¤‰æ›´ -->
          <col style="width:110px"><!-- æ“ä½œ -->
          <col style="width:110px"><!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ -->
          <col style="width:220px"><!-- ã‚¿ã‚¤ãƒˆãƒ« -->
          <col style="width:520px"><!-- èª¬æ˜ -->
          <col style="width:240px"><!-- ä½æ‰€ -->
          <col style="width:280px"><!-- åœ°å›³URL -->
          <col style="width:220px"><!-- ã‚¿ã‚° -->
          <col style="width:220px"><!-- ã‚¨ãƒªã‚¢ -->
          <col style="width:140px"><!-- é›»è©± -->
          <col style="width:140px"><!-- ä¼‘ã¿ -->
          <col style="width:180px"><!-- å–¶æ¥­æ™‚é–“ -->
          <col style="width:110px"><!-- é§è»Š -->
          <col style="width:90px"><!-- å°æ•° -->
          <col style="width:200px"><!-- æ”¯æ‰•æ–¹æ³• -->
          <col style="width:220px"><!-- å‚™è€ƒ -->
        </colgroup>
        <thead>
          <tr>
            <th>æ“ä½œ</th>
            <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
            <th>èª¬æ˜</th>
            <th>ä½æ‰€</th>
            <th>åœ°å›³URL</th>
            <th>ã‚¿ã‚°</th>
            <th>ã‚¨ãƒªã‚¢</th>
            <th>é›»è©±</th>
            <th>ä¼‘ã¿</th>
            <th>å–¶æ¥­æ™‚é–“</th>
            <th>é§è»Š</th>
            <th>å°æ•°</th>
            <th>æ”¯æ‰•æ–¹æ³•</th>
            <th>å‚™è€ƒ</th>
          </tr>
        </thead>
        <tbody id="tbody">
          {% for e in entries %}
          <tr>
            <!-- å…ˆé ­ï¼šå‰Šé™¤ãƒœã‚¿ãƒ³ + å®‰å®šID/ãƒªãƒ³ã‚¯ä¿æŒã®hidden -->
            <td class="row-actions">
              <!-- â˜… å®‰å®šIDï¼šã‚µãƒ¼ãƒå´ã®ãƒãƒ¼ã‚¸ä¿å­˜ç”¨ï¼ˆæœªè¡¨ç¤ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿æŒï¼‰ -->
              <input type="hidden" name="row_id[]" value="{{ loop.index0 }}">
              <!-- â˜… links[] ãŒãƒ†ãƒ³ãƒ—ãƒ¬ã«ç„¡ã„ç’°å¢ƒã§ã‚‚æ—¢å­˜å€¤ã‚’ä¿æŒã™ã‚‹ãŸã‚ã® hidden -->
              <input type="hidden" name="links[]" value="{% if e.links %}{{ ','.join(e.links) }}{% endif %}">
              <button class="btn danger" type="button" onclick="removeRow(this)">å‰Šé™¤</button>
            </td>

            <td>
              <select name="category[]" onchange="onCategoryChange(this)">
                {% for c in cat_list %}
                  <option value="{{ c }}" {% if e.category == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
              </select>
            </td>
            <td><input type="text" name="title[]" value="{{ e.title or '' }}"></td>
            <td><textarea name="desc[]">{{ e.desc or '' }}</textarea></td>
            <td><input type="text" name="address[]" value="{{ e.address or '' }}"></td>
            <td><input type="text" name="map[]" value="{{ e.map or '' }}"></td>
            <td><input type="text" name="tags[]" value="{% if e.tags %}{{ ','.join(e.tags) }}{% endif %}"></td>
            <td><input type="text" name="areas[]" value="{% if e.areas %}{{ ','.join(e.areas) }}{% endif %}"></td>

            <td><input data-shop type="text" name="tel[]" value="{{ e.tel or '' }}"></td>
            <td><input data-shop type="text" name="holiday[]" value="{{ e.holiday or '' }}"></td>
            <td><input data-shop type="text" name="open_hours[]" value="{{ e.open_hours or '' }}"></td>
            <td>
              <select data-shop name="parking[]">
                <option value="" {% if not e.parking %}selected{% endif %}>-</option>
                <option value="ã‚ã‚Š" {% if e.parking=='ã‚ã‚Š' %}selected{% endif %}>ã‚ã‚Š</option>
                <option value="ãªã—" {% if e.parking=='ãªã—' %}selected{% endif %}>ãªã—</option>
              </select>
            </td>
            <td><input data-shop type="text" name="parking_num[]" value="{{ e.parking_num or '' }}"></td>
            <td><input data-shop type="text" name="payment[]" value="{% if e.payment %}{{ ','.join(e.payment) }}{% endif %}"></td>
            <td><input data-shop type="text" name="remark[]" value="{{ e.remark or '' }}"></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="savebar">
      <button class="btn" type="button" onclick="addRow()">ï¼‹ è¡Œã‚’è¿½åŠ </button>
      <button class="btn" type="submit">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
    </div>

    <template id="row-template">
      <tr>
        <!-- å…ˆé ­ï¼šå‰Šé™¤ãƒœã‚¿ãƒ³ + å®‰å®šID/ãƒªãƒ³ã‚¯ä¿æŒã®hidden -->
        <td class="row-actions">
          <input type="hidden" name="row_id[]" value="">
          <input type="hidden" name="links[]" value="">
          <button class="btn danger" type="button" onclick="removeRow(this)">å‰Šé™¤</button>
        </td>

        <td>
          <select name="category[]" onchange="onCategoryChange(this)">
            <option value="è¦³å…‰" selected>è¦³å…‰</option>
            <option value="é£²é£Ÿ">é£²é£Ÿ</option>
            <option value="å®¿æ³Š">å®¿æ³Š</option>
            <option value="è¨ºç™‚æ‰€">è¨ºç™‚æ‰€</option>
            <option value="å½¹æ‰€">å½¹æ‰€</option>
            <option value="äº¤é€š">äº¤é€š</option>
            <option value="ãƒã‚¹">ãƒã‚¹</option>
            <option value="ã‚¤ãƒ™ãƒ³ãƒˆ">ã‚¤ãƒ™ãƒ³ãƒˆ</option>
            <option value="ç‰¹å£²">ç‰¹å£²</option>
          </select>
        </td>
        <td><input type="text" name="title[]" value=""></td>
        <td><textarea name="desc[]"></textarea></td>
        <td><input type="text" name="address[]" value=""></td>
        <td><input type="text" name="map[]" value=""></td>
        <td><input type="text" name="tags[]" value=""></td>
        <td><input type="text" name="areas[]" value=""></td>

        <td><input data-shop type="text" name="tel[]" value=""></td>
        <td><input data-shop type="text" name="holiday[]" value=""></td>
        <td><input data-shop type="text" name="open_hours[]" value=""></td>
        <td>
          <select data-shop name="parking[]">
            <option value="" selected>-</option>
            <option value="ã‚ã‚Š">ã‚ã‚Š</option>
            <option value="ãªã—">ãªã—</option>
          </select>
        </td>
        <td><input data-shop type="text" name="parking_num[]" value=""></td>
        <td><input data-shop type="text" name="payment[]" value=""></td>
        <td><input data-shop type="text" name="remark[]" value=""></td>
      </tr>
    </template>
  </form>
</div>
</body>
</html>
