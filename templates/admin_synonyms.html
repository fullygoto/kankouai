<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>類義語（シノニム）管理</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body{font-family:'Segoe UI','メイリオ',sans-serif;background:#f6faf9;margin:0}
  .topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #e6edf3;position:sticky;top:0;z-index:10}
  .topbar h1{font-size:18px;margin:0}
  .btn{display:inline-block;border:1px solid #cfe1ef;border-radius:10px;padding:7px 12px;text-decoration:none;color:#2a8ed8;background:#fff}
  .container{max-width:980px;margin:18px auto;padding:0 14px 24px}
  .card{background:#fff;border:1px solid #e6edf3;border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 3px 14px #b7d3e022}
  h2{font-size:16px;margin:0 0 10px}
  label{font-weight:600}
  textarea,input[type=text]{width:100%;box-sizing:border-box;border:1px solid #bfd2e2;border-radius:8px;padding:8px 10px;font-size:14px}
  textarea{min-height:120px;resize:vertical}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid #eef3f7;padding:8px;text-align:left;vertical-align:top}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:760px){.row{grid-template-columns:1fr}}
  .hint{font-size:.9em;color:#667}
</style>
</head>
<body>
  <div class="topbar">
    <h1>類義語（シノニム）管理</h1>
    <a class="btn" href="/admin/entry">データ管理に戻る</a>
  </div>

  <div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="card" style="background:#f7fffb;border-color:#bfe9d2">
          {% for m in messages %}<div>{{ m }}</div>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="card">
      <h2>インポート / エクスポート</h2>
      <div class="row">
        <form method="post" action="{{ url_for('admin_synonyms_import') }}" enctype="multipart/form-data">
          <label>ファイルから（synonyms.json）</label>
          <input type="file" name="json_file" accept=".json">
          <div style="margin-top:8px">
            <button type="submit" class="btn">インポート</button>
            <span class="hint">※既存は上書きされます</span>
          </div>
        </form>
        <form method="post" action="{{ url_for('admin_synonyms_import') }}">
          <label>テキストで貼り付け</label>
          <textarea name="json_text" placeholder='{"タグ":[ "別名", "同義語" ], ...}'></textarea>
          <div style="margin-top:8px">
            <button type="submit" class="btn">インポート</button>
            <span class="hint">※既存は上書きされます</span>
          </div>
        </form>
      </div>
      <div style="margin-top:10px">
        <a class="btn" href="{{ url_for('admin_synonyms_export') }}">エクスポート（ダウンロード）</a>
      </div>
    </div>

    <div class="card">
      <h2>AIで自動生成（登録タグに沿って）</h2>
      <form method="post" action="{{ url_for('admin_synonyms_autogen') }}">
        <div class="row">
          <div>
            <label>対象</label><br>
            <label><input type="radio" name="target" value="missing" checked> 辞書に無いタグのみ</label><br>
            <label><input type="radio" name="target" value="all"> すべての登録タグ</label>
          </div>
          <div>
            <label>更新モード</label><br>
            <label><input type="radio" name="mode" value="append" checked> 追記（既存に加える）</label><br>
            <label><input type="radio" name="mode" value="overwrite"> 上書き（置き換え）</label>
          </div>
        </div>
        <div style="margin-top:10px">
          <button type="submit" class="btn">AIで生成＆登録</button>
          <span class="hint">※OpenAI APIキーが必要。大きい辞書は数十秒かかる場合があります。</span>
        </div>
      </form>
    </div>

    <div class="card">
      <h2>現在の辞書（{{ (synonyms|length) if synonyms else 0 }} タグ）</h2>
      {% if synonyms %}
        <table>
          <thead><tr><th>タグ</th><th>シノニム</th></tr></thead>
          <tbody>
            {% for tag, syns in synonyms.items() %}
              <tr>
                <td><b>{{ tag }}</b></td>
                <td>{{ (", ".join(syns)) if syns else "" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="hint" style="margin-top:8px">※詳細編集は当面インポートで上書きしてください。</div>
      {% else %}
        <div class="hint">辞書が空です。インポートするか、AIで生成してください。</div>
      {% endif %}
    </div>
  </div>
</body>
</html>
