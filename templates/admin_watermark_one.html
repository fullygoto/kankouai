<!-- templates/admin_watermark_one.html（新規作成：丸ごとコピペOK） -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>透かし編集（単体）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{ --bg:#f6faf9; --card:#fff; --muted:#567; --line:#e7eef5; --brand:#2a8ed8; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:var(--bg);padding:20px}
    .container{background:var(--card);max-width:1000px;margin:20px auto;padding:22px;border-radius:14px;box-shadow:0 4px 18px #b7d3e033}
    h1{margin:0 0 14px}
    .muted{color:var(--muted);font-size:.95em}
    .btn{display:inline-block;padding:8px 14px;border:none;border-radius:8px;background:var(--brand);color:#fff;cursor:pointer;text-decoration:none}
    .btn.ghost{background:#fff;color:var(--brand);border:1px solid #b7d3e0}
    .btn.small{padding:6px 10px;font-size:.92em}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-top:12px}
    .card{border:1px solid #e5eef5;border-radius:10px;padding:12px;background:#fbfdff}
    .name{display:block;margin-top:6px;font-size:.92em;color:#345;word-break:break-all}
    img{max-width:100%;height:auto;border:1px solid #e5eef5;border-radius:8px;background:#fff}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .row{margin:10px 0}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .danger{background:#e35}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h1>透かし編集（単体）</h1>
      <div class="actions">
        <a class="btn ghost" href="{{ url_for('admin_watermark', q=src) }}">← 一覧に戻る</a>
        <a class="btn ghost" href="{{ url_for('admin_entry') }}">データ管理に戻る</a>
      </div>
    </div>

    {% set i = src.rfind('.') %}
    {% set base = src[:i] if i!=-1 else src %}
    {% set ext  = src[i:]  if i!=-1 else '' %}
    {% set none  = base ~ '__none' ~ ext %}
    {% set goto  = base ~ '__goto' ~ ext %}
    {% set fully = base ~ '__fullygoto' ~ ext %}
    {% set _del_action = (safe_url_for('admin_media_delete') or '/admin/media/delete') %}

    <div class="row">
      <div class="muted">対象ファイル：</div>
      <div style="word-break:break-all">{{ src }}</div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="muted">元画像</div>
        <a href="{{ url_for('admin_media_img', filename=src) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=src) }}" alt="src" loading="lazy">
        </a>
        <div class="name">{{ src }}</div>
      </div>

      <div class="card">
        <div class="muted">透かし：なし（__none）</div>
        <a href="{{ url_for('admin_media_img', filename=none) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=none) }}" alt="none" loading="lazy">
        </a>
        <div class="actions">
          <form method="post" action="{{ url_for('admin_watermark') }}">
            <input type="hidden" name="selected_existing" value="{{ src }}">
            <input type="hidden" name="wm" value="none">
            <input type="hidden" name="force" value="1">
            <button class="btn small" type="submit">この派生を再生成</button>
          </form>
          <a class="btn ghost small" href="{{ url_for('admin_media_img', filename=none) }}" download>ダウンロード</a>
        </div>
        <div class="name">{{ none }}</div>
      </div>

      <div class="card">
        <div class="muted">透かし：＠Goto City（__goto）</div>
        <a href="{{ url_for('admin_media_img', filename=goto) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=goto) }}" alt="goto" loading="lazy">
        </a>
        <div class="actions">
          <form method="post" action="{{ url_for('admin_watermark') }}">
            <input type="hidden" name="selected_existing" value="{{ src }}">
            <input type="hidden" name="wm" value="goto">
            <input type="hidden" name="force" value="1">
            <button class="btn small" type="submit">この派生を再生成</button>
          </form>
          <a class="btn ghost small" href="{{ url_for('admin_media_img', filename=goto) }}" download>ダウンロード</a>
        </div>
        <div class="name">{{ goto }}</div>
      </div>

      <div class="card">
        <div class="muted">透かし：＠fullyGOTO（__fullygoto）</div>
        <a href="{{ url_for('admin_media_img', filename=fully) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=fully) }}" alt="fully" loading="lazy">
        </a>
        <div class="actions">
          <form method="post" action="{{ url_for('admin_watermark') }}">
            <input type="hidden" name="selected_existing" value="{{ src }}">
            <input type="hidden" name="wm" value="fully">
            <input type="hidden" name="force" value="1">
            <button class="btn small" type="submit">この派生を再生成</button>
          </form>
          <a class="btn ghost small" href="{{ url_for('admin_media_img', filename=fully) }}" download>ダウンロード</a>
        </div>
        <div class="name">{{ fully }}</div>
      </div>
    </div>

    <hr>

    <div class="row actions">
      <!-- 3種まとめて再生成（既存ロジックを再利用） -->
      <form method="post" action="{{ url_for('admin_watermark') }}">
        <input type="hidden" name="selected_existing" value="{{ src }}">
        <input type="hidden" name="wm" value="all">
        <input type="hidden" name="force" value="1">
        <button class="btn" type="submit">この画像の派生を全部再生成</button>
      </form>

      <!-- 元画像の削除 -->
      <form method="post" action="{{ _del_action }}" onsubmit="return confirm('元画像と派生を削除します。よろしいですか？');">
        <input type="hidden" name="filename" value="{{ src }}">
        <button class="btn danger" type="submit">元画像を削除</button>
      </form>
    </div>

    <div class="row" style="margin-top:12px">
      <a class="btn ghost" href="{{ url_for('admin_watermark', q=src) }}">← 一覧に戻る</a>
      <a class="btn ghost" href="{{ url_for('admin_entry') }}">データ管理に戻る</a>
    </div>
  </div>
</body>
</html>
