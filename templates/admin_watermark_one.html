<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>透かし：単体編集</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:#f6faf9;padding:20px;margin:0}
    .container{max-width:960px;margin:0 auto;background:#fff;border-radius:14px;box-shadow:0 4px 18px #b7d3e033;padding:22px}
    h1{margin:0 0 16px}
    .btn{display:inline-block;padding:8px 14px;border-radius:8px;border:none;background:#2a8ed8;color:#fff;text-decoration:none;cursor:pointer}
    .btn.ghost{background:#fff;color:#2a8ed8;border:1px solid #b7d3e0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    fieldset{border:1px solid #e4edf6;border-radius:12px;padding:14px;margin:16px 0}
    legend{padding:0 8px;color:#234;font-weight:600}
    img{max-width:100%;border-radius:12px;border:1px solid #e4edf6;background:#fff}
    label{display:flex;flex-direction:column;gap:6px;font-size:.95em;color:#234}
    input[type="number"],select{padding:8px 10px;border-radius:8px;border:1px solid #b7cfe2;background:#fff}
    .muted{color:#567;font-size:.9em}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:14px}
    .card{border:1px solid #e4edf6;border-radius:12px;padding:12px;background:#fbfdff}
    .name{font-size:.92em;color:#234;word-break:break-all;margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <div class="row" style="justify-content:space-between">
      <h1>透かし：単体編集</h1>
      <a class="btn ghost" href="{{ url_for('admin_watermark') }}">← 一覧に戻る</a>
    </div>

    <div class="row" style="margin-top:10px">
      <div style="flex:1;min-width:260px">
        <div class="muted">元画像</div>
        <a href="{{ url_for('admin_media_img', filename=src) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=src) }}" alt="{{ src }}" loading="lazy">
        </a>
        <div class="name">{{ src }}</div>
      </div>
      <div style="flex:1;min-width:260px">
        <div class="muted">透かし適用後</div>
        {% if wm_exists %}
          <a href="{{ url_for('admin_media_img', filename=wm_name) }}" target="_blank" rel="noopener">
            <img src="{{ url_for('admin_media_img', filename=wm_name) }}" alt="{{ wm_name }}" loading="lazy">
          </a>
          <div class="name">{{ wm_name }}</div>
        {% else %}
          <div class="muted">透かし画像はまだ生成されていません。</div>
        {% endif %}
      </div>
    </div>

    <form method="post" action="{{ url_for('admin_watermark_one_regen') }}">
      <input type="hidden" name="src" value="{{ src }}">
      <fieldset>
        <legend>透かしを再生成</legend>
        <div class="row">
          <label>透かしPNG：
            <select name="watermark_file">
              {% if watermark_files and watermark_files|length %}
                {% for f in watermark_files %}
                  <option value="{{ f }}">{{ f }}</option>
                {% endfor %}
              {% else %}
                <option value="">透かしPNGが見つかりません</option>
              {% endif %}
            </select>
          </label>
          <label>スケール（短辺比率 %）：
            <input type="number" name="scale" min="0.08" max="0.12" step="0.005" value="{{ scale_default }}">
          </label>
          <label>不透明度（0〜1）：
            <input type="number" name="opacity" min="0.05" max="1" step="0.05" value="{{ opacity_default }}">
          </label>
        </div>
        <div class="muted" style="margin-top:6px">上書きはバックアップを作成した後に行われます。</div>
        <button class="btn" type="submit" style="margin-top:10px">この画像を再生成する</button>
      </fieldset>
    </form>

    <form method="post" action="{{ url_for('admin_media_delete') }}" onsubmit="return confirm('元画像と透かし派生を削除します。よろしいですか？');">
      <input type="hidden" name="filename" value="{{ src }}">
      <button class="btn ghost" type="submit">この画像を削除する</button>
    </form>
  </div>
</body>
</html>
