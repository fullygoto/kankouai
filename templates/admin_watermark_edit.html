<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>透かし編集：{{ filename }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:#f6faf9;padding:20px;margin:0}
    .container{max-width:960px;margin:0 auto;background:#fff;border-radius:14px;box-shadow:0 4px 18px #b7d3e033;padding:22px}
    h1{margin:0 0 16px}
    .btn{display:inline-block;padding:8px 14px;border-radius:8px;border:none;background:#2a8ed8;color:#fff;text-decoration:none;cursor:pointer}
    .btn.ghost{background:#fff;color:#2a8ed8;border:1px solid #b7d3e0}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start}
    fieldset{border:1px solid #e4edf6;border-radius:12px;padding:14px;margin:16px 0}
    legend{padding:0 8px;color:#234;font-weight:600}
    img{max-width:100%;border-radius:12px;border:1px solid #e4edf6;background:#fff}
    label{display:flex;flex-direction:column;gap:6px;font-size:.95em;color:#234}
    input[type="number"],select{padding:8px 10px;border-radius:8px;border:1px solid #b7cfe2;background:#fff}
    .muted{color:#567;font-size:.9em}
  </style>
</head>
<body>
  <div class="container">
    <div class="row" style="justify-content:space-between">
      <h1>透かし編集</h1>
      <a class="btn ghost" href="{{ url_for('admin_watermark') }}">← 一覧へ戻る</a>
    </div>

    <div class="row">
      <div style="flex:1;min-width:260px">
        <div class="muted">元画像</div>
        <a href="{{ url_for('admin_media_img', filename=filename) }}" target="_blank" rel="noopener">
          <img src="{{ url_for('admin_media_img', filename=filename) }}" loading="lazy" alt="{{ filename }}">
        </a>
        <div class="muted" style="margin-top:6px;word-break:break-all">{{ filename }}</div>
      </div>
      <div style="flex:1;min-width:260px">
        <div class="muted">現在の透かしプレビュー</div>
        {% if preview.wm %}
          <a href="{{ preview.wm }}" target="_blank" rel="noopener">
            <img src="{{ preview.wm }}" loading="lazy" alt="preview">
          </a>
        {% else %}
          <div class="muted">透かし画像はまだ生成されていません。</div>
        {% endif %}
      </div>
    </div>

    <form method="post" action="{{ url_for('admin_watermark_edit_apply') }}" style="margin-top:18px">
      <input type="hidden" name="filename" value="{{ filename }}">
      <fieldset>
        <legend>透かしを再生成</legend>
        <div class="row">
          <label>透かしPNG：
            <select name="watermark_file">
              {% if watermark_files and watermark_files|length %}
                {% for f in watermark_files %}
                  <option value="{{ f }}" {{ 'selected' if selected_watermark==f else '' }}>{{ f }}</option>
                {% endfor %}
              {% else %}
                <option value="">透かしPNGが見つかりません</option>
              {% endif %}
            </select>
          </label>
          <label>スケール（短辺比率 %）：
            <input type="number" name="scale" min="0.08" max="0.12" step="0.005" value="{{ scale }}">
          </label>
          <label>不透明度（0〜1）：
            <input type="number" name="opacity" min="0.05" max="1" step="0.05" value="{{ opacity }}">
          </label>
        </div>
        <div class="muted" style="margin-top:6px">保存時はバックアップを作成し、安全に置き換えます。</div>
        <div class="row" style="margin-top:12px">
          <button class="btn" type="submit">再生成する</button>
          <a class="btn ghost" href="{{ url_for('admin_watermark') }}">キャンセル</a>
        </div>
      </fieldset>
    </form>
  </div>
</body>
</html>
